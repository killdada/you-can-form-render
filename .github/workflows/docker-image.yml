name: Docker Image CI

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      # 设置node环境，安装依赖
      - uses: actions/setup-node@v3
        with:
          node-version: 16.10.0
      - run: npm i -g yarn
      # 初始化前后端依赖
      - run: yarn install
      # 打包前端项目
      - run: yarn build:client
      # 使用docker-compose发布
      - name: publish
        uses: pennsignals/publish_docker-compose@v0.1.0
        with:
          version: "1.0.0"
          docker_compose: "docker-compose.yml"
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
